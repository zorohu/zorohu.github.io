<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="hexo"><meta name="keyword" content=""><link rel="shortcut icon" href="/img/favicon.ico"><title>whistle web开发调试神器 - AuthorZero的博客 | AuthorZero&#39;s Blog</title><link rel="canonical" href="https://authorzero.com/2023/03/05/tools-proxy/"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/hux-blog.min.css"><link rel="stylesheet" href="/css/highlight.css"><link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]--><script></script><meta name="generator" content="Hexo 6.3.0"></head><body ontouchstart=""><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">AuthorZero的博客</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/archives/">Archives</a></li><li><a href="/tags/">Tags</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");function handleMagic(e){0<$navbar.className.indexOf("in")?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}$toggle.addEventListener("click",handleMagic)</script><style type="text/css">header.intro-header{background-image:url(post-bg-2023.jpg)}</style><header class="intro-header"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><div class="tags"><a class="tag" href="/tags/#技术" title="技术">技术</a> <a class="tag" href="/tags/#工具" title="工具">工具</a> <a class="tag" href="/tags/#代理" title="代理">代理</a></div><h1>whistle web开发调试神器</h1><h2 class="subheading">&#34;whistle代理使用&#34;</h2><span class="meta">Posted by author.zero on 2023-03-05</span></div></div></div></div></header><article><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container"><blockquote><p>“Never complain, never explain. Resist the temptation to defend yourself or make excuses. ”</p></blockquote><h2 id="为什么要使用whistle"><a href="#为什么要使用whistle" class="headerlink" title="为什么要使用whistle"></a>为什么要使用whistle</h2><p>不知道大家有没有遇到过这样的问题：线上接口出现了问题，但是不知道是接口传参出现了问题还是接口本身出了问题，毕竟每个上了线的功能肯定都是经过了测试了的。然后后端哼哧哼哧的打开调试窗口看传参是否正确，然后复制请求在自己本地先测试一下，看是不是自己接口有问题。但是这个时候有一个很麻烦的事情的，可能这个接口的参数是通过前面多个步骤操作得来的请求数据，这个时候就不得不自己mock数据测试了。所以我今天想给大家介绍的这个工具就是可以将线上的前端请求代理到本地或开发环境，这样你就能够通过在页面点击的方式去复现线上的bug，而且这样能够确保100%还原操作，而不用自己去moke数据了。听完这些不知道你心动了没，废话不多说。开始主角的介绍</p><h2 id="whistle介绍"><a href="#whistle介绍" class="headerlink" title="whistle介绍"></a>whistle介绍</h2><blockquote><p>主要用于查看、修改HTTP、HTTPS、Websocket的请求、响应，也可以作为HTTP代理服务器使用，不同于Fiddler通过断点修改请求响应的方式，whistle采用的是类似配置系统hosts的方式，一切操作都可以通过配置实现，支持域名、路径、正则表达式、通配符、通配路径等多种匹配方式，且可以通过Node模块扩展功能：</p></blockquote><p>从以上的官方介绍可以看出，whistle其实就是一个代理工具。对没错它就是一个代理软件，但是在使用方上确有很多令人惊喜的小tips(手动狗头):</p><ol><li>代理线上请求到本地服务</li><li>帮助前端mock后台请求</li><li>…</li></ol><h3 id="whistle安装"><a href="#whistle安装" class="headerlink" title="whistle安装"></a>whistle安装</h3><p>安装直接参考安装文档即可 <a target="_blank" rel="noopener" href="https://wproxy.org/whistle/install.html" title="安装文档">安装文档</a><br>注意事项：</p><ul><li><p>命令行启动<br>官方文档的 启动命令为 <code>npm i -g whistle &amp;&amp; w2 start --init</code> , 请注意这里的init。</p><blockquote><p>–init [bypass] auto set global proxy (and bypass) and install root CA</p></blockquote><p>根据官方的help说明，init 命令会将whistle设置成 系统的全局代理并且安装whistle生成的root证书，所以可能会导致，安装完成之后浏览器无法上网的问题。<br>解决方案也很简单</p><ol><li>只使用 <code>npm i -g whistle &amp;&amp; w2 start</code> 不init。也就是不将whistle设置为系统代理</li><li>使用<code>w2 proxy off</code>关闭whistle为全局代理</li></ol></li><li><p>证书安装<br>如果你没有使用 init 命令初始化。那whistle就并不会将生成的证书安装到系统里。所以也就无法代理https请求<br>这种情况下，只用下载证书，将证书安装到受信任的域中即可</p></li></ul><h3 id="whistle使用"><a href="#whistle使用" class="headerlink" title="whistle使用"></a>whistle使用</h3><p>whistle的使用有很多技巧，包括不限于 代理请求 转发请求 mock请求等</p><ul><li><p>代理请求<br>代理请求用的最多，也是功能最强大的功能。其强大的代理能力取决于它的匹配规则。<br>需要注意的是如果存在前端和后台存在跨域问题，那么代理配置得加上 OPTIONS（预检请求） 的处理，配置如下</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">```cors2</span><br><span class="line">origin: *</span><br><span class="line">headers: Content-Type,token</span><br><span class="line">credentials: true</span><br><span class="line">maxAge: <span class="number">300000</span></span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">https:<span class="regexp">//</span>test<span class="regexp">/api/</span> includeFilter:<span class="regexp">//m</span>:options resCors:<span class="regexp">//</span>&#123;cors2&#125; statusCode:<span class="regexp">//</span><span class="number">200</span></span><br><span class="line">https:<span class="regexp">//</span>test<span class="regexp">/api/</span>  http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">11040</span><span class="regexp">/ resCors:/</span><span class="regexp">/&#123;cors2&#125;</span></span><br></pre></td></tr></table></figure></li></ul><p>​	这上面的配置是将跨域的预检请求直接返回200,在代理真正的请求到本地即可</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后，代理的工具可能很多，但是我个人觉得whistle是一个轻量级且全平台的代理工具，可以很方便的调试web页面，调试请求。以上的使用只是我个人在工作过程中的最常用以及遇到的部分问题的总结，如果有更好的工具和使用方法欢迎联系交流</p><p align="right">—— author.zero 后记于 2023.03.05</p><hr><ul class="pager"><li class="previous"><a href="/2023/04/08/git-use/" data-toggle="tooltip" data-placement="top" title="git-use">&larr; Previous Post</a></li><li class="next"><a href="/2023/02/25/mysql-lock/" data-toggle="tooltip" data-placement="top" title="mysql死锁 Deadlock">Next Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0 visible-lg-block sidebar-container catalog-container"><div class="side-catalog"><hr class="hidden-sm hidden-xs"><h5><a class="catalog-toggle" href="#">CATALOG</a></h5><ul class="catalog-body"></ul></div></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"><section><h5><a href="/tags/">FEATURED TAGS</a></h5><div class="tags"><a class="tag" href="/tags/#技术" title="技术">技术</a> <a class="tag" href="/tags/#工具" title="工具">工具</a> <a class="tag" href="/tags/#代理" title="代理">代理</a></div></section><hr><h5>FRIENDS</h5><ul class="list-inline"><li><a href="http://blog.kaijun.rocks" target="_blank">Kaijun&#39;s Blog</a></li><li><a href="http://huangxuan.me" target="_blank">Hux Blog</a></li><li><a href="#" target="_blank">Foo</a></li><li><a href="#" target="_blank">Bar</a></li><li><a href="#" target="_blank">Example Friends</a></li><li><a href="#" target="_blank">It helps SEO</a></li></ul></div></div></div></article><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){anchors.options={visible:"always",placement:"right",icon:"#"},anchors.add().remove(".intro-header h1").remove(".subheading").remove(".sidebar-container h5")})</script><style>@media all and (min-width:800px){.anchorjs-link{position:absolute;left:-.75em;font-size:1.1em;margin-top:-.1em}}</style><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target="_blank" href="https://twitter.com/author22282473"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="https://www.zhihu.com/people/auth0"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-stack-1x fa-inverse">知</i></span></a></li><li><a target="_blank" href="https://weibo.com/ZoroP"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-weibo fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="https://www.facebook.com/author.zero"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="https://github.com/zorohu"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="https://www.linkedin.com/in/author.zero"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; AuthorZero的博客 2018 - 2023 <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">鄂ICP备20003318号</a><br>Theme by <a target="_blank" rel="noopener" href="https://huangxuan.me">Hux</a> <span style="display:inline-block;margin:0 5px"><i class="fa fa-heart"></i> </span>Ported by <a target="_blank" rel="noopener" href="https://blog.kaijun.rocks">Kaijun</a> |<iframe style="margin-left:2px;margin-bottom:-5px" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true"></iframe><br><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次 本站访客数<span id="busuanzi_value_site_uv"></span>人次 本文总阅读量<span id="busuanzi_value_page_pv"></span>次</span><br><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date(2018,4,13,19,23,16);now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",250)</script></p></div></div></div></footer><script src="/js/jquery.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/hux-blog.min.js"></script><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>0!==$("#tag_cloud").length&&async("https://authorzero.com/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){var c=document.querySelector("nav");c&&FastClick.attach(c)})</script><script>var _gaId="UA-49627206-1",_gaDomain="huangxuan.me";!function(a,e,n,g,t,c){a.GoogleAnalyticsObject=g,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=+new Date,t=e.createElement(n),c=e.getElementsByTagName(n)[0],t.async=1,t.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(t,c)}(window,document,"script","ga"),ga("create",_gaId,_gaDomain),ga("send","pageview")</script><script>var _baId="4cc1f2d8f3067386cc5cdb626a202900",_hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?"+_baId;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(e,c)}()</script><script type="text/javascript">function generateCatalog(e){_containerSelector="div.post-container";var a,l,n,t,o,c=$(_containerSelector).find("h1,h2,h3,h4,h5,h6");return $(e).html(""),c.each(function(){a=$(this).prop("tagName").toLowerCase(),t="#"+$(this).prop("id"),l=$(this).text(),o=$('<a href="'+t+'" rel="nofollow">'+l+"</a>"),n=$('<li class="'+a+'_nav"></li>').append(o),$(e).append(n)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),async("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><img src="https://authorzero.com/img/icon_wechat.png" width="0" height="0"></body></html>